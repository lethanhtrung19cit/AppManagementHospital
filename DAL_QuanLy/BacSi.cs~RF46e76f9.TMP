using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using DTO_QuanLy;
namespace DAL_QuanLy
{
    class BacSi : connection
    {
        public DataTable getBacSi()
        {
            conn = new SqlConnection("Data Source=DESKTOP-76IH46T\\SQLEXPRESS;Initial Catalog=quanlibenhvien;Persist Security Info=True;User ID=sa;Password=lethanhtrung");
            SqlDataAdapter da = new SqlDataAdapter("select ctdv.MaChiTietDV 'Chi tiết dịch vụ', bn.MaBenhNhan 'Mã bệnh nhân', TenBenhNhan'Tên bệnh nhân', dv.MaDichVu'Mã dịch vụ', TenDichVu 'Tên dịch vụ', ThanhGia 'Thành giá', DonViTinh 'Đơn vị tính', SoLanSuDung 'Số lần sử dụng', picture 'Ảnh' from BenhNhan bn inner join (ChiTietDichVu ctdv inner join DichVu dv on ctdv.MaDichVu = dv.MaDichVu) on bn.MaBenhNhan = ctdv.MaBenhNhan", conn);
            DataTable dtDichVu = new DataTable();
            da.Fill(dtDichVu);

            return dtDichVu;

        }
        public string maBacSi()
        {

            conn.Open();
            string sql = string.Format("declare cur_MaBS cursor for select count(MaBacSi) from dsbs open cur_MaBS declare @countbs int fetch next from cur_MaBS into @countbs while @@FETCH_STATUS=0 begin select MaBacSi='BS0'+CAST(@countbs+1 as varchar(10)) from dsbs fetch next from cur_MaBS into @countbs end close cur_MaBS deallocate cur_MaBS");
            SqlCommand a = new SqlCommand(sql, conn);
            String a1 = (String)a.ExecuteScalar();
            conn.Close();
            return a1;
        }
    }
}
